<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="utf-8" />
    <title>🤖 Bot Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        /* CSS kodlari o'zgarishsiz qoldi */
        :root {
            --primary-dark: #0f0f0f;
            --secondary-dark: #1a1a1a;
            --accent-blue: #3b82f6;
            --accent-blue-light: #60a5fa;
            --gray-light: #e0e0e0;
            --gray-medium: #8c8c8c;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        body {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #2d2d2d 100%);
            min-height: 100vh;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            color: var(--gray-light);
        }

        .navbar-custom {
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--accent-blue);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.1);
        }

        .card {
            background: var(--secondary-dark);
            border: 1px solid #333;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            color: var(--gray-light);
        }

        .card:hover {
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.1);
            border-color: var(--accent-blue);
        }

        .card-header {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-bottom: 1px solid #333;
            border-radius: 12px 12px 0 0 !important;
            padding: 15px 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #1d4ed8 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--accent-blue-light) 0%, var(--accent-blue) 100%);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #f87171 0%, var(--danger) 100%);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            color: #000;
            transition: all 0.3s ease;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #fbbf24 0%, var(--warning) 100%);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
            color: #000;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info) 0%, #1d4ed8 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #60a5fa 0%, var(--info) 100%);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #34d399 0%, var(--success) 100%);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }

        .form-control {
            background: #6e6e6e;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 12px 15px;
            transition: all 0.3s ease;
            color: var(--gray-light);
        }

        .form-control:focus {
            background: #333;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            color: var(--gray-light);
        }

        .form-label {
            color: var(--accent-blue);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .section-title {
            color: var(--accent-blue);
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #333;
            font-size: 1.25rem;
        }

        .result-box {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border: 1px solid #333;
            color: var(--gray-light);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .result-box.success {
            border-color: var(--success);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
        }

        .result-box.error {
            border-color: var(--danger);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
        }

        .channel-input-group {
            transition: all 0.3s ease;
            border-radius: 8px;
            overflow: hidden;
        }

        .input-group-text {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border: 1px solid #444;
            color: var(--accent-blue);
            font-weight: 600;
        }

        .user-info-card {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border: 1px solid #333;
            color: var(--gray-light);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .logo-text {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #1d4ed8 100%);
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            font-size: 1.5rem;
        }

        .floating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--secondary-dark);
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .floating-notification.show {
            transform: translateX(0);
        }

        .icon-glow {
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.6));
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .card {
                margin-bottom: 15px;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
            }

            .row {
                margin-left: -5px;
                margin-right: -5px;
            }

            .col-md-6,
            .col-md-8,
            .col-md-4 {
                padding-left: 5px;
                padding-right: 5px;
            }
        }

        @media (max-width: 576px) {
            .card-body {
                padding: 15px;
            }

            .card-header {
                padding: 10px 15px;
            }

            .display-5 {
                font-size: 1.5rem;
            }

            .section-title {
                font-size: 1.1rem;
            }
        }

        /* Animatsiyalar */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="fas fa-robot fa-2x icon-glow me-2" style="color: #3b82f6"></i>
                <span class="logo-text">Bot Admin Panel</span>
            </a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item">
                    <span class="status-indicator status-online"></span>
                    <span class="text-light">Online</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Floating Notification -->
    <div id="notification" class="floating-notification">
        <div class="d-flex align-items-center">
            <i class="fas fa-bell text-info me-2"></i>
            <span id="notification-text">Xabar kanalga yuborildi!</span>
        </div>
    </div>

    <div class="container py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card fade-in">
                    <div class="card-body text-center py-4">
                        <h1 class="logo-text mb-2">🤖 Bot Admin Panel</h1>
                        <p class="text-muted mb-0">
                            Barcha operatsiyalar
                            <strong class="text-info">@chektekshirbot</strong> kanaliga
                            yuboriladi
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pul boshqaruvi -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card fade-in" style="animation-delay: 0.1s">
                    <div class="card-header">
                        <h4 class="section-title mb-0">
                            <i class="fas fa-plus-circle me-2"></i>💸 Pul Yuborish
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Foydalanuvchi ID</label>
                            <input
                                id="user_id"
                                class="form-control"
                                placeholder="7214885905"
                            />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Summa (so'm)</label>
                            <input
                                id="amount"
                                type="number"
                                class="form-control"
                                placeholder="5000"
                            />
                        </div>
                        <button class="btn btn-primary w-100" onclick="sendBalance()">
                            <i class="fas fa-paper-plane me-2"></i>Pul Yuborish
                        </button>
                        <div class="mt-2 text-center">
                            <small class="text-muted"
                                >Foydalanuvchi ID ga pul qo'shiladi</small
                            >
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card fade-in" style="animation-delay: 0.2s">
                    <div class="card-header">
                        <h4 class="section-title mb-0">
                            <i class="fas fa-minus-circle me-2"></i>❌ Pul Ayirish
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Foydalanuvchi ID</label>
                            <input
                                id="sub_user_id"
                                class="form-control"
                                placeholder="7214885905"
                            />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Summa (so'm)</label>
                            <input
                                id="sub_amount"
                                type="number"
                                class="form-control"
                                placeholder="5000"
                            />
                        </div>
                        <button class="btn btn-danger w-100" onclick="subtractBalance()">
                            <i class="fas fa-ban me-2"></i>Pul Ayirish
                        </button>
                        <div class="mt-2 text-center">
                            <small class="text-muted"
                                >Foydalanuvchi ID dan pul ayiriladi</small
                            >
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bir kishiga xabar yuborish -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card fade-in" style="animation-delay: 0.3s">
                    <div class="card-header">
                        <h4 class="section-title mb-0">
                            <i class="fas fa-envelope me-2"></i>📨 Bir Kishiga Xabar
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Foydalanuvchi ID</label>
                                <input
                                    id="single_user_id"
                                    class="form-control"
                                    placeholder="7214885905"
                                />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Xabar matni</label>
                                <textarea
                                    id="single_message"
                                    class="form-control"
                                    rows="2"
                                    placeholder="Xabar matnini kiriting..."
                                ></textarea>
                            </div>
                        </div>
                        <button class="btn btn-info w-100" onclick="sendToUser()">
                            <i class="fas fa-share me-2"></i>Xabar Yuborish
                        </button>
                        <div class="mt-2 text-center">
                            <small class="text-muted"
                                >Foydalanuvchi ID ga xabar yuboriladi</small
                            >
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Foydalanuvchi ma'lumotlari -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card fade-in" style="animation-delay: 0.4s">
                    <div class="card-header">
                        <h4 class="section-title mb-0">
                            <i class="fas fa-user me-2"></i>👤 Foydalanuvchi Ma'lumotlari
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <input
                                    id="user_info_id"
                                    class="form-control"
                                    placeholder="Foydalanuvchi ID ni kiriting..."
                                />
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-success w-100" onclick="getUserInfo()">
                                    <i class="fas fa-search me-2"></i>Ma'lumotlarni Yuklash
                                </button>
                            </div>
                        </div>
                        <div id="user_info_result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Majburiy kanallar -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card fade-in" style="animation-delay: 0.5s">
                    <div class="card-header">
                        <h4 class="section-title mb-0">
                            <i class="fas fa-link me-2"></i>🔗 Majburiy Kanallar
                        </h4>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-3">
                            Maksimal 5 ta kanal qo'shish mumkin (@ bilan boshlanishi kerak)
                        </p>

                        <div id="channel_list" class="mb-3">
                            <!-- Kanallar dynamic ravishda yuklanadi -->
                        </div>

                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-primary" onclick="saveChannels()">
                                <i class="fas fa-save me-2"></i>Kanallarni Saqlash
                            </button>
                            <button
                                class="btn btn-outline-info"
                                onclick="addChannelField()"
                            >
                                <i class="fas fa-plus me-2"></i>Yangi Kanal Qo'shish
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Xabar va statistika -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card fade-in" style="animation-delay: 0.6s">
                    <div class="card-header">
                        <h4 class="section-title mb-0">
                            <i class="fas fa-bullhorn me-2"></i>📢 Hammaga Xabar
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Xabar matni</label>
                            <textarea
                                id="broadcast_msg"
                                class="form-control"
                                rows="3"
                                placeholder="Assalomu alaykum! Yangi yangilik..."
                            ></textarea>
                        </div>
                        <button class="btn btn-warning w-100" onclick="sendBroadcast()">
                            <i class="fas fa-share me-2"></i>Xabar Yuborish
                        </button>
                        <div class="mt-2 text-center">
                            <small class="text-muted"
                                >Barcha foydalanuvchilaga xabar yuboriladi</small
                            >
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card fade-in" style="animation-delay: 0.7s">
                    <div class="card-header">
                        <h4 class="section-title mb-0">
                            <i class="fas fa-chart-bar me-2"></i>📊 Umumiy Statistika
                        </h4>
                    </div>
                    <div class="card-body text-center py-4">
                        <i
                            class="fas fa-chart-pie display-1 text-info mb-3 icon-glow"
                        ></i>
                        <p class="text-muted">
                            Bot statistikasini ko'rish uchun quyidagi tugmani bosing
                        </p>
                        <button class="btn btn-info w-100" onclick="getStats()">
                            <i class="fas fa-sync-alt me-2"></i>Statistika Yuklash
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Natijalar paneli -->
        <div class="row">
            <div class="col-12">
                <div class="card fade-in" style="animation-delay: 0.8s">
                    <div class="card-header">
                        <h4 class="section-title mb-0">
                            <i class="fas fa-list-alt me-2"></i>📋 Operatsiya Natijalari
                        </h4>
                    </div>
                    <div class="card-body">
                        <div id="out" class="result-box">
                            <div class="text-center py-3">
                                <i class="fas fa-info-circle fa-2x text-muted mb-3"></i>
                                <p class="mb-0">
                                    Bu yerda operatsiya natijalari ko'rinadi...
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>


        
        const MAIN_API_BASE = "http://127.0.0.1:5000";
        const SECRET_KEY = "yangieskibot";
        const PAYMENTS_CHANNEL = "@chektekshirbot";

        const ADD_BALANCE_ENDPOINT = `${MAIN_API_BASE}/admin/add_balance`;
        const SUBTRACT_BALANCE_ENDPOINT = `${MAIN_API_BASE}/admin/subtract_balance`;
        const SET_CHANNEL_ENDPOINT = `${MAIN_API_BASE}/admin/set_channel`;
        const BROADCAST_ENDPOINT = `${MAIN_API_BASE}/admin/broadcast`;
        const GET_CHANNEL_ENDPOINT = `${MAIN_API_BASE}/admin/get_channel`;
        const STATS_ENDPOINT = `${MAIN_API_BASE}/admin/stats`;
        const USER_INFO_ENDPOINT = `${MAIN_API_BASE}/admin/user_info`;
        const SEND_TO_USER_ENDPOINT = `${MAIN_API_BASE}/admin/send_to_user`;

        // Notification funksiyasi
        function showNotification(message, type = "info") {
            const notification = document.getElementById("notification");
            const notificationText = document.getElementById("notification-text");

            notificationText.textContent = message;
            notification.classList.add("show");

            setTimeout(() => {
                notification.classList.remove("show");
            }, 3000);
        }

        // === Yangi kanal qo'shish ===
        function addChannelField() {
            const channelList = document.getElementById("channel_list");
            const existingChannels = channelList.querySelectorAll(".channel-input-group");
            
            // Maksimal 5 ta kanal tekshirish
            if (existingChannels.length >= 5) {
                showNotification("❌ Maksimal 5 ta kanal qo'shish mumkin!", "error");
                return;
            }

            const newIndex = existingChannels.length + 1;
            const field = document.createElement("div");
            field.className = "input-group mb-2 channel-input-group";
            field.innerHTML = `
                <span class="input-group-text bg-primary text-white">${newIndex}</span>
                <input class="form-control channel-input" placeholder="@kanal${newIndex}">
                <button class="btn btn-outline-danger" onclick="removeChannelField(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            channelList.appendChild(field);
            showNotification("✅ Yangi kanal qatori qo'shildi", "success");
        }

        // === Kanalni o'chirish ===
        function removeChannelField(button) {
            const channelList = document.getElementById("channel_list");
            const existingChannels = channelList.querySelectorAll(".channel-input-group");
            
            // Kamida 1 ta kanal qolishi kerak
            if (existingChannels.length <= 1) {
                showNotification("❌ Kamida 1 ta kanal bo'lishi kerak!", "error");
                return;
            }

            button.closest(".channel-input-group").remove();
            
            // Qolgan kanal raqamlarini yangilash
            const remainingChannels = channelList.querySelectorAll(".channel-input-group");
            remainingChannels.forEach((channel, index) => {
                const span = channel.querySelector(".input-group-text");
                span.textContent = index + 1;
            });
            
            showNotification("✅ Kanal o'chirildi", "success");
        }

        // === Pul yuborish ===
        async function sendBalance() {
            const uid = document.getElementById("user_id").value.trim();
            const amt = parseInt(document.getElementById("amount").value);
            if (!uid || !amt) {
                showResult("❌ Iltimos, ID va summa kiriting!", false);
                return;
            }

            try {
                showNotification("⏳ Pul qo'shish so'rovi amalga oshirilmoqda...");

                const resp = await fetch(ADD_BALANCE_ENDPOINT, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        user_id: uid,
                        amount: amt,
                        secret_key: SECRET_KEY,
                    }),
                });
                const j = await resp.json();

                if (j.success) {
                    const resultText = `✅ Foydalanuvchi ${uid} ga ${amt} so'm yuborildi!\n📊 Yangi balans: ${j.new_balance} so'm\n📢 Xabar kanalga yuborildi`;
                    showResult(resultText, true);
                    showNotification(`✅ ${uid} ga ${amt} so'm qo'shildi`);

                    // Pul yuborish tugmasi ostiga xabar
                    const balanceBtn = document.querySelector(".btn-primary");
                    const originalText = balanceBtn.innerHTML;
                    balanceBtn.innerHTML = `<i class="fas fa-check me-2"></i>✅ ${uid} ga ${amt} so'm yuborildi`;
                    balanceBtn.classList.remove("btn-primary");
                    balanceBtn.classList.add("btn-success");

                    // 3 soniyadan so'ng asl holatiga qaytarish
                    setTimeout(() => {
                        balanceBtn.innerHTML = originalText;
                        balanceBtn.classList.remove("btn-success");
                        balanceBtn.classList.add("btn-primary");
                        showResult(
                            "✅ Pul qo'shish so'rovi amalga oshdi va kanalga ma'lumot yuborildi",
                            true
                        );
                    }, 3000);
                } else {
                    showResult(`❌ Xato: ${j.error || "Noma'lum xato"}`, false);
                    showNotification("❌ Xatolik yuz berdi");
                }
            } catch (error) {
                console.error("Pul yuborishda xato:", error);
                showResult(`❌ Server bilan aloqa yo'q.`, false);
                showNotification("❌ Server bilan aloqa yo'q");
            }
        }

        // === Pul ayirish ===
        async function subtractBalance() {
            const uid = document.getElementById("sub_user_id").value.trim();
            const amt = parseInt(document.getElementById("sub_amount").value);
            if (!uid || !amt) {
                showResult("❌ Iltimos, ID va summa kiriting!", false);
                return;
            }

            try {
                showNotification("⏳ Pul ayirish so'rovi amalga oshirilmoqda...");

                const resp = await fetch(SUBTRACT_BALANCE_ENDPOINT, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        user_id: uid,
                        amount: amt,
                        secret_key: SECRET_KEY,
                    }),
                });
                const j = await resp.json();

                if (j.success) {
                    const resultText = `✅ Foydalanuvchi ${uid} dan ${amt} so'm ayirildi!\n📊 Yangi balans: ${j.new_balance} so'm\n📢 Xabar kanalga yuborildi`;
                    showResult(resultText, true);
                    showNotification(`✅ ${uid} dan ${amt} so'm ayirildi`);

                    // Pul ayirish tugmasi ostiga xabar
                    const subtractBtn = document.querySelector(".btn-danger");
                    const originalText = subtractBtn.innerHTML;
                    subtractBtn.innerHTML = `<i class="fas fa-check me-2"></i>✅ ${uid} dan ${amt} so'm ayirildi`;
                    subtractBtn.classList.remove("btn-danger");
                    subtractBtn.classList.add("btn-success");

                    // 3 soniyadan so'ng asl holatiga qaytarish
                    setTimeout(() => {
                        subtractBtn.innerHTML = originalText;
                        subtractBtn.classList.remove("btn-success");
                        subtractBtn.classList.add("btn-danger");
                        showResult(
                            "✅ Pul ayirish so'rovi amalga oshdi va kanalga ma'lumot yuborildi",
                            true
                        );
                    }, 3000);
                } else {
                    showResult(`❌ Xato: ${j.error || "Noma'lum xato"}`, false);
                    showNotification("❌ Xatolik yuz berdi");
                }
            } catch (error) {
                console.error("Pul ayirishda xato:", error);
                showResult(`❌ Server bilan aloqa yo'q.`, false);
                showNotification("❌ Server bilan aloqa yo'q");
            }
        }

        // === Bir kishiga xabar yuborish ===
        async function sendToUser() {
            const uid = document.getElementById("single_user_id").value.trim();
            const msg = document.getElementById("single_message").value.trim();
            if (!uid || !msg) {
                showResult("❌ Iltimos, ID va xabar matnini kiriting!", false);
                return;
            }

            try {
                showNotification("⏳ Xabar yuborish so'rovi amalga oshirilmoqda...");

                const resp = await fetch(SEND_TO_USER_ENDPOINT, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        user_id: uid,
                        message: msg,
                        secret_key: SECRET_KEY,
                    }),
                });
                const j = await resp.json();

                if (j.success) {
                    const resultText = `✅ Foydalanuvchi ${uid} ga xabar yuborildi!\n📢 Xabar kanalga yuborildi`;
                    showResult(resultText, true);
                    showNotification(`✅ ${uid} ga xabar yuborildi`);

                    // Xabar yuborish tugmasi ostiga xabar
                    const messageBtn = document.querySelector(".btn-info");
                    const originalText = messageBtn.innerHTML;
                    messageBtn.innerHTML = `<i class="fas fa-check me-2"></i>✅ ${uid} ga xabar yuborildi`;
                    messageBtn.classList.remove("btn-info");
                    messageBtn.classList.add("btn-success");

                    // 3 soniyadan so'ng asl holatiga qaytarish
                    setTimeout(() => {
                        messageBtn.innerHTML = originalText;
                        messageBtn.classList.remove("btn-success");
                        messageBtn.classList.add("btn-info");
                        showResult(
                            "✅ Xabar yuborish so'rovi amalga oshdi va kanalga ma'lumot yuborildi",
                            true
                        );
                    }, 3000);
                } else {
                    showResult(`❌ Xato: ${j.error || "Noma'lum xato"}`, false);
                    showNotification("❌ Xatolik yuz berdi");
                }
            } catch (error) {
                console.error("Xabar yuborishda xato:", error);
                showResult(`❌ Server bilan aloqa yo'q.`, false);
                showNotification("❌ Server bilan aloqa yo'q");
            }
        }

        // === Foydalanuvchi ma'lumotlari ===
        async function getUserInfo() {
            const uid = document.getElementById("user_info_id").value.trim();
            if (!uid) {
                document.getElementById("user_info_result").innerHTML =
                    '<div class="alert alert-warning">Iltimos, foydalanuvchi ID kiriting!</div>';
                return;
            }

            try {
                showNotification("⏳ Foydalanuvchi ma'lumotlari yuklanmoqda...");

                const resp = await fetch(
                    `${USER_INFO_ENDPOINT}?user_id=${uid}&secret_key=${SECRET_KEY}`
                );
                const j = await resp.json();

                if (j.success) {
                    const user = j.user;
                    const html = `
                            <div class="user-info-card">
                                <h5><i class="fas fa-user me-2"></i>${user.username}</h5>
                                <p><i class="fas fa-id-card me-2"></i>ID: ${user.id}</p>
                                <p><i class="fas fa-wallet me-2"></i>Balans: ${user.balance}</p>
                                <p><i class="fas fa-money-bill-wave me-2"></i>Yechilgan: ${user.withdrawn}</p>
                                <p><i class="fas fa-chart-line me-2"></i>Umumiy topilgan: ${user.total_earned}</p>
                                <p><i class="fas fa-chart-bar me-2"></i>Umumiy yechilgan: ${user.total_withdrawn}</p>
                                <p><i class="fas fa-users me-2"></i>Referallar: ${user.referrals} ta</p>
                                <p><i class="fas fa-calendar me-2"></i>Ro'yxatdan o'tgan: ${user.joined_date}</p>
                                <p><i class="fas fa-clock me-2"></i>Oxirgi faollik: ${user.last_active}</p>
                            </div>
                        `;
                    document.getElementById("user_info_result").innerHTML = html;
                    showNotification(`✅ ${uid} ma'lumotlari yuklandi`);

                    // Ma'lumot yuklash tugmasi ostiga xabar
                    const infoBtn = document.querySelector(".btn-success");
                    const originalText = infoBtn.innerHTML;
                    infoBtn.innerHTML = `<i class="fas fa-check me-2"></i>✅ ${uid} ma'lumotlari yuklandi`;
                    infoBtn.classList.remove("btn-success");
                    infoBtn.classList.add("btn-info");

                    // 3 soniyadan so'ng asl holatiga qaytarish
                    setTimeout(() => {
                        infoBtn.innerHTML = originalText;
                        infoBtn.classList.remove("btn-info");
                        infoBtn.classList.add("btn-success");
                        showResult(
                            "✅ Foydalanuvchi ma'lumotlari yuklandi va kanalga ma'lumot yuborildi",
                            true
                        );
                    }, 3000);
                } else {
                    document.getElementById(
                        "user_info_result"
                    ).innerHTML = `<div class="alert alert-danger">${
                        j.error || "Foydalanuvchi topilmadi"
                    }</div>`;
                    showNotification("❌ Foydalanuvchi topilmadi");
                }
            } catch (error) {
                console.error("Foydalanuvchi ma'lumotlarini olishda xato:", error);
                document.getElementById("user_info_result").innerHTML =
                    '<div class="alert alert-danger">Server bilan aloqa yo\'q</div>';
                showNotification("❌ Server bilan aloqa yo'q");
            }
        }

        // === Kanallarni saqlash ===
        async function saveChannels() {
            const inputs = document.querySelectorAll(".channel-input");
            const channels = [];
            inputs.forEach((inp) => {
                const val = inp.value.trim();
                if (val) channels.push(val);
            });

            if (channels.length === 0) {
                showResult("❌ Kamida bitta kanal kiriting!", false);
                return;
            }

            try {
                showNotification("⏳ Kanallar saqlanmoqda...");

                const resp = await fetch(SET_CHANNEL_ENDPOINT, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        channels: channels,
                        secret_key: SECRET_KEY,
                    }),
                });
                const j = await resp.json();

                if (j.success) {
                    showResult(
                        `✅ Kanallar saqlandi: ${j.channels.join(
                            ", "
                        )}\n📢 Xabar kanalga yuborildi`,
                        true
                    );
                    showNotification("✅ Kanallar saqlandi");

                    // Kanallarni saqlash tugmasi ostiga xabar
                    const saveBtn = document.querySelector(".btn-primary");
                    const originalText = saveBtn.innerHTML;
                    saveBtn.innerHTML = `<i class="fas fa-check me-2"></i>✅ Kanallar saqlandi`;
                    saveBtn.classList.remove("btn-primary");
                    saveBtn.classList.add("btn-success");

                    // 3 soniyadan so'ng asl holatiga qaytarish
                    setTimeout(() => {
                        saveBtn.innerHTML = originalText;
                        saveBtn.classList.remove("btn-success");
                        saveBtn.classList.add("btn-primary");
                        showResult(
                            "✅ Kanallarni saqlash so'rovi amalga oshdi va kanalga ma'lumot yuborildi",
                            true
                        );
                    }, 3000);
                } else {
                    showResult(`❌ Xato: ${j.error || "Noma'lum xato"}`, false);
                    showNotification("❌ Xatolik yuz berdi");
                }
            } catch {
                showResult(`❌ Server bilan aloqa yo'q.`, false);
                showNotification("❌ Server bilan aloqa yo'q");
            }
        }

        // === Barchaga xabar yuborish ===
        async function sendBroadcast() {
            const msg = document.getElementById("broadcast_msg").value.trim();
            if (!msg) {
                showResult("❌ Iltimos, xabar matnini kiriting!", false);
                return;
            }

            try {
                showNotification("⏳ Hammaga xabar yuborilmoqda...");

                const resp = await fetch(BROADCAST_ENDPOINT, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: msg, secret_key: SECRET_KEY }),
                });
                const j = await resp.json();

                if (j.success) {
                    showResult(
                        `✅ ${j.sent_count} foydalanuvchiga yuborildi!\n📢 Xabar kanalga yuborildi`,
                        true
                    );
                    showNotification(`✅ ${j.sent_count} foydalanuvchiga yuborildi`);

                    // Hammaga xabar tugmasi ostiga xabar
                    const broadcastBtn = document.querySelector(".btn-warning");
                    const originalText = broadcastBtn.innerHTML;
                    broadcastBtn.innerHTML = `<i class="fas fa-check me-2"></i>✅ ${j.sent_count} foydalanuvchiga yuborildi`;
                    broadcastBtn.classList.remove("btn-warning");
                    broadcastBtn.classList.add("btn-success");

                    // 3 soniyadan so'ng asl holatiga qaytarish
                    setTimeout(() => {
                        broadcastBtn.innerHTML = originalText;
                        broadcastBtn.classList.remove("btn-success");
                        broadcastBtn.classList.add("btn-warning");
                        showResult(
                            "✅ Hammaga xabar yuborish so'rovi amalga oshdi va kanalga ma'lumot yuborildi",
                            true
                        );
                    }, 3000);
                } else {
                    showResult(`❌ Xato: ${j.error || "Noma'lum xato"}`, false);
                    showNotification("❌ Xatolik yuz berdi");
                }
            } catch {
                showResult(`❌ Server bilan aloqa yo'q.`, false);
                showNotification("❌ Server bilan aloqa yo'q");
            }
        }

        // === Statistika ===
        async function getStats() {
            try {
                showNotification("⏳ Statistika yuklanmoqda...");

                const resp = await fetch(
                    `${STATS_ENDPOINT}?secret_key=${SECRET_KEY}`
                );
                const j = await resp.json();

                if (j.total_users !== undefined) {
                    showResult(
                        `<b>📊 Statistika</b><br>
                            👥 Foydalanuvchilar: ${j.total_users} ta<br>
                            🔥 Faol foydalanuvchilar: ${j.active_users} ta<br>
                            💰 Umumiy balans: ${j.formatted.total_balance}<br>
                            💸 Yechilgan summa: ${j.formatted.total_withdrawn}<br>
                            📈 Umumiy topilgan: ${j.formatted.total_earned}<br>
                            👥 Jami referallar: ${j.total_referrals} ta<br>
                            📢 Xabar kanalga yuborildi`,
                        true
                    );
                    showNotification("✅ Statistika yuklandi");

                    // Statistika tugmasi ostiga xabar
                    const statsBtn = document.querySelector(".btn-info");
                    const originalText = statsBtn.innerHTML;
                    statsBtn.innerHTML = `<i class="fas fa-check me-2"></i>✅ Statistika yuklandi`;
                    statsBtn.classList.remove("btn-info");
                    statsBtn.classList.add("btn-success");

                    // 3 soniyadan so'ng asl holatiga qaytarish
                    setTimeout(() => {
                        statsBtn.innerHTML = originalText;
                        statsBtn.classList.remove("btn-success");
                        statsBtn.classList.add("btn-info");
                        showResult(
                            "✅ Statistika so'rovi amalga oshdi va kanalga ma'lumot yuborildi",
                            true
                        );
                    }, 3000);
                }
            } catch {
                showResult(`❌ Server bilan aloqa yo'q.`, false);
                showNotification("❌ Server bilan aloqa yo'q");
            }
        }

        // === Natijani ko'rsatish ===
        function showResult(message, isSuccess) {
            const out = document.getElementById("out");
            out.innerHTML = message;
            out.className = isSuccess ? "result-box success" : "result-box error";
        }

        // === Kanallarni yuklash ===
        async function loadChannels() {
            try {
                const resp = await fetch(
                    `${GET_CHANNEL_ENDPOINT}?secret_key=${SECRET_KEY}`
                );
                const j = await resp.json();

                const channelList = document.getElementById("channel_list");
                channelList.innerHTML = "";

                if (j.channels && j.channels.length > 0) {
                    j.channels.forEach((channel, index) => {
                        const field = document.createElement("div");
                        field.className = "input-group mb-2 channel-input-group";
                        field.innerHTML = `
                                    <span class="input-group-text bg-primary text-white">${
                                        index + 1
                                    }</span>
                                    <input class="form-control channel-input" value="${channel}" placeholder="@kanal${
                            index + 1
                        }">
                                    <button class="btn btn-outline-danger" onclick="removeChannelField(this)">
                                        <i class="fas fa-times"></i>
                                    </button>
                                `;
                        channelList.appendChild(field);
                    });
                } else {
                    for (let i = 0; i < 3; i++) {
                        addChannelField();
                    }
                }
            } catch (error) {
                console.log("Kanallarni yuklashda xato:", error);
                for (let i = 0; i < 3; i++) {
                    addChannelField();
                }
            }
        }

        // Sayt yuklanganda kanallarni yuklash
        window.onload = loadChannels;
    </script>
</body>
</html>